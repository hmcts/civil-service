# Robotics EventHistory Refactor Log

Central place to track the EventHistory refactor: baselines, extracted utilities, strategy rollout, and regression evidence.

---

## Problem Statement

- `EventHistoryMapper` currently spans more than 2.7k lines; every robotics branch is hard-coded inside one `buildEvents` method.
- Case classification, date/party formatting, and event construction are interwoven, driving cyclomatic complexity into the thousands and making new event additions risky.
- Supporting “robotics builder” helpers duplicate logic (IDs, strings, sequencing) and mirror the monolith’s structure.

## Scope (must-have outcomes)

1. Extract per-feature strategies (breathing space, DJ, mediation, paper/offline, etc.) so `EventHistoryMapper` acts as an orchestrator.
2. Centralise shared formatting and ID helpers for reuse across all robotics mappers.
3. Align `RoboticsDataMapper` and sibling classes with the new strategy and utility layers to remove stream/loop duplication.
4. Back the new strategies with focussed unit tests that lock in current event payloads for representative spec/unspec and multi-party scenarios.

## Acceptance Criteria

- `EventHistoryMapper`’s primary methods shrink below 300 lines and delegate to strategy classes.
- New shared utilities replace existing duplication, and all pre-refactor regression tests stay green.
- Robotics regression plus the new unit suites confirm zero change to emitted event JSON for existing flows.

---

## Phase Roadmap

| Phase | Purpose | Status | Notes |
| --- | --- | --- | --- |
| 0 | Snapshot existing `EventHistory` outputs for key scenarios | Complete | Golden JSON captured; harness hardened for deterministic comparisons |
| 1 | Extract shared formatting/util utilities | Complete | Utilities adopted across mapper, data mappers, and handlers |
| 2 | Introduce strategy infrastructure | Complete | Strategies extracted for every mapper branch; robotics sits entirely on the strategy layer |
| 3+ | Incrementally migrate feature-specific logic (breathing space, DJ, mediation, GA, etc.) | Complete | Utility alignment finished; future feature migrations will extend strategy layer |

---

## Phase 0 – Baseline Snapshots

**Goal**  
Lock current `EventHistory` payloads so future refactors prove behaviour parity.

**Fixture Matrix**

*Captured*  
- `unspec_claim_progression` – `CaseDataBuilder.builder().atStateClaimDetailsNotified()`
- `unspec_taken_offline` – `CaseDataBuilder.builder().atStateTakenOfflineByStaff()`
- `unspec_ga_strike_out` – `...atStateTakenOfflineByStaff().getGeneralApplicationWithStrikeOut("001").getGeneralStrikeOutApplicationsDetailsWithCaseState(PROCEEDS_IN_HERITAGE.getDisplayedValue())`
- `unspec_multi_party_same_solicitor` – `...atStateNotificationAcknowledged1v2SameSolicitor().multiPartyClaimOneDefendantSolicitor()`
- `multi_applicant_proceed` – `...multiPartyClaimTwoApplicants().atStateApplicant2RespondToDefenceAndProceed_2v1()`
- `spec_full_defence` – `...setClaimTypeToSpecClaim().atStateSpec1v1ClaimSubmitted().atStateRespondent1v1FullDefenceSpec()`
- `breathing_space_standard` – `CaseDataBuilder.builder().addLiftBreathingSpace()`
- `breathing_space_mental_health` – `CaseDataBuilder.builder().addLiftMentalBreathingSpace()`
- `spec_mediation_part_admit` – `CaseDataBuilder.builder().setClaimTypeToSpecClaim().atStateSpec1v1ClaimSubmitted().atStateRespondent1v1FullAdmissionSpec()` with mediation opt-in, DQ court data, and applicant response date pushed beyond `now()`.
- `default_judgment_unspec` – `CaseDataBuilder.builder().getDefaultJudgment1v1Case()` with JO created date, claimant LiP decision, payment date, and totals overridden for determinism.

*Queued for capture*  
- _None_

**Snapshot Plan**

1. For each fixture, call `mapper.buildEvents(caseData, BEARER_TOKEN)` in a dedicated test.
2. Serialise results with the robotics Jackson configuration.
3. Store outputs under `src/test/resources/robotics/golden/<scenario>.json`.
4. Assert equality in regression tests that regenerate the payload.

**Progress Log**

- 2025-10-28 (pass 1): Captured golden snapshots for `unspec_claim_progression`, `unspec_taken_offline`, and `unspec_ga_strike_out`; normalised dynamic timestamps via `CaseDataNormalizer`; introduced `EventHistoryGoldenSnapshotTest`.
- 2025-10-28 (pass 2): Added snapshots for `unspec_multi_party_same_solicitor`, `multi_applicant_proceed`, and `spec_full_defence`.
- 2025-10-28 (pass 3): Added breathing space variants (`breathing_space_standard`, `breathing_space_mental_health`); `default_judgment_unspec` remains outstanding due to dynamic payment dates.
- 2025-10-28 (pass 4): Captured `spec_mediation_part_admit` (future-dated applicant response guard) and `default_judgment_unspec` (deterministic JO timestamp, payment date, and LiP decision); snapshot assertions now compare serialised JSON to avoid BigDecimal formatting drift.
- 2025-10-29 (noise sweep): Confirmed Phase 1 helpers are not present in the codebase after the rollback; regression harness continues to pass on the baseline branch.

---

## Phase 1 – Shared Utility Extraction (Plan)

**Research Findings (2025-10-29)**

- `EventHistoryMapper` still carries ~2.7k lines with direct `LocalDateTime.now()` calls at multiple hotspots (e.g. mediation fallback: `EventHistoryMapper.java:2698`, Ga/NoC flows: `EventHistoryMapper.java:369`, `EventHistoryMapper.java:2709`), making determinism dependent on runtime calls.
- “RPA Reason” text templates are duplicated across numerous branches (`EventHistoryMapper.java:235`, `EventHistoryMapper.java:2449`, `EventHistoryMapper.java:2712`), often with subtle punctuation differences that should be centralised.
- Litigious party ID selection and solicitor reference truncation logic is duplicated between `RoboticsDataMapper` and `RoboticsDataMapperForSpec`, and partially reimplemented inside `EventHistoryMapper` (applicant/defendant iteration blocks).
- Sequencing of events relies on `prepareEventSequence(...)` scattered inside the mapper, while `EventHistorySequencer` exposes similar responsibilities for external callers; consolidating sequencing logic will reduce divergence.

**Utility Boundaries (target state)**

| Utility | Responsibility | Primary Call Sites |
| --- | --- | --- |
| `RoboticsTimelineHelper` (name TBD) | Provide deterministic date/time values (wrapping `Time.now()`) and ISO formatting helpers for directions questionnaire, mediation, default judgment, and breathing-space branches. | `EventHistoryMapper` (lines 2690+, 333+, 2480+), `RoboticsDataMapper`, `RoboticsDataMapperForSpec`. |
| `RoboticsEventTextFormatter` | Hold template methods for recurring “RPA Reason …” text, intention summaries, and GA/DJ reason strings; expose parameterised builders to avoid inline `String.format` duplication. | `EventHistoryMapper` offline/miscellaneous builders, GA strike-out handlers, mediation events. |
| `RoboticsPartyLookup` | Centralise applicant/respondent litigious party ID resolution, solicitor reference truncation (24 char rule), and multi-party proceed decisions. | Both data mappers, `EventHistoryMapper` applicant/defendant loops, solicitor builders. |
| `RoboticsSequenceGenerator` | Wrap `EventHistorySequencer` so both mappers and future strategies use a single sequencing entrypoint. | `EventHistoryMapper.buildEvents` branches, any future strategy classes. |

**Implementation Plan**

1. **Introduce utilities without wiring**  
   - Add helper classes under `service.robotics.support` with unit tests covering edge cases (null timestamps, truncation when length < 24, varied RPA template inputs).  
   - Ensure helpers consume `Time`, `FeatureToggleService`, or other dependencies via constructor injection to keep behaviour testable.

2. **Replace date/time fallbacks**  
   - Swap direct `LocalDateTime.now()` usage in `EventHistoryMapper` with the helper while keeping method signatures unchanged.  
   - Update both data mappers to request formatted dates through the helper; re-run golden snapshots to confirm parity.

3. **Centralise text templates**  
   - Move constant definitions and `String.format` calls into `RoboticsEventTextFormatter`; update all branches that emit “RPA Reason …” text.  
   - Add regression-focused unit tests exercising the formatter with representative messages from golden fixtures.

4. **Consolidate party/sequencing logic**  
   - Refactor duplicated party ID/solicitor sections in both data mappers to delegate to the new helper.  
   - Replace inline `prepareEventSequence` calls with the shared generator, ensuring sequencing increments remain identical (compare golden outputs).

5. **Stabilise Spring wiring and tests**  
   - Register utilities as Spring beans and extend existing mapper tests (`EventHistoryMapperTest`, `RoboticsDataMapperTest`, `RoboticsDataMapperForSpecTest`) to cover the new collaborators.  
   - Re-run `EventHistoryGoldenSnapshotTest` plus mapper unit suites after each integration step.

**Regression Guardrails**

- Continue to execute `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest` after every batch of replacements.
- When text templates move, spot-check golden fixtures most sensitive to messaging changes (`unspec_ga_strike_out.json`, `default_judgment_unspec.json`, `spec_mediation_part_admit.json`) to ensure zero drift.
- Hold the existing golden corpus as Phase 1’s acceptance gate; no new scenarios required unless we expose additional surface area.

**Progress Log**

- 2025-10-29 (pass 1): Added foundational helpers (`RoboticsTimelineHelper`, `RoboticsEventTextFormatter`, `RoboticsPartyLookup`, `RoboticsSequenceGenerator`) with standalone unit tests; wiring into mappers scheduled for the next pass.
- 2025-10-29 (pass 2): Replaced `LocalDateTime.now()` usages in `EventHistoryMapper` with `RoboticsTimelineHelper`, registered the helper as a Spring bean, and updated mapper tests to rely on deterministic `Time` mocks; golden snapshots and `EventHistoryMapperTest` suites re-run to confirm parity.
- 2025-10-29 (pass 3): Wired `RoboticsEventTextFormatter`, `RoboticsPartyLookup`, and `RoboticsSequenceGenerator` into `EventHistoryMapper`; delegated sequence calculations to the shared helper and swapped key RPA reason strings (defendant response outcomes, NoC/LR vs LiP messages) to the formatter while keeping snapshot outputs unchanged.
- 2025-10-29 (pass 4): Ported the claim-dismissal/offline RPA messages to formatter helpers for consistency; regression suites re-run to confirm payload parity.
- 2025-10-29 (pass 5): Migrated multiparty intention/proceed text to formatter helpers and aligned the 1v1 proceed strings via the shared constant; mapper and golden snapshot suites remain green.
- 2025-10-29 (pass 6): Extracted the remaining manual determination/judgment/offline strings to formatter helpers (including JO pathways and “only one respondent notified”); mapper + golden suites and formatter unit tests re-run successfully.
- 2025-10-29 (pass 7): Swept up the residual RPA literals (unrepresented/unregistered defendants, SDONotDrawn, notice-of-change, applicant response fallback) into formatter helpers; regression suites remain green.
- 2025-10-29 (pass 8): Centralised the “Claimant proceeds” messaging through `RoboticsEventTextFormatter.claimantProceeds()`, removed the last hard-coded RPA literal, and re-ran mapper plus golden snapshot suites.
- 2025-10-29 (pass 9): Extended the formatter across Camunda task/event handlers, introduced helper coverage for all remaining RPA messages, and re-ran handler + robotics regression tests to confirm parity.
- 2025-10-29 (pass 10): Adopted `RoboticsPartyLookup` in the unspec/spec data mappers for solicitor reference truncation and party IDs, refreshed mapper tests, and reverified the golden suite to ensure unchanged payloads.

**Phase 1 Closure Checklist**

- [x] Confirm no remaining inline robotics strings outside helpers (scan before moving to strategies).
- [x] Share helper usage guidelines with strategy owners (see below).
- [x] Lock in utility unit tests for any new helper APIs introduced during strategy work.
- [x] Decide handover point into Phase 2 (candidate: breathing space strategy extraction) once checks above are green.

**Helper Usage Notes (for Phase 2 authors)**

- Always source RPA text via `RoboticsEventTextFormatter`; if a phrase is missing, add a helper and cover it in `RoboticsEventTextFormatterTest`.
- Rely on `RoboticsPartyLookup` for litigious party IDs and solicitor reference truncation—avoid reintroducing `substring` logic or hard-coded IDs.
- Use `RoboticsTimelineHelper` (and the injected `Time` mock) for any new date/timestamp fallbacks so golden tests remain deterministic.
- Fetch sequencing via `RoboticsSequenceGenerator.nextSequence(...)` when emitting additional robotics events.
- Before deleting any mapper branch, ensure the replacement strategy relies on these shared helpers and is exercised by focussed unit tests plus a golden snapshot regression run.

## Phase 2 – Strategy Extraction (Plan)

**Initial target**

- Start with breathing-space logic (standard + mental-health). It is self-contained (`caseData.getBreathing()`), already covered by golden fixtures, and exercises the new timeline/formatter helpers.

**Strategy structure**

- Define an `EventHistoryStrategy` SPI (e.g. `supports(caseData)` + `contribute(builder, caseData, authToken)`).
- Implement `BreathingSpaceEventStrategy`, injecting `RoboticsTimelineHelper`, `RoboticsSequenceGenerator`, and reusing the shared helpers.
- The strategy emits the enter/lift events (standard and mental-health) using the helper to build deterministic timestamps and shared message templates.

**Mapper orchestration**

- Inject a list of strategys into `EventHistoryMapper`.
- During `buildEvents`, iterate the strategys and delegate when `supports` returns true.
- Remove the inline `buildBreathingSpaceEvent` branch once the strategy is wired, keeping sequencing/timeline helpers in the strategy layer.

**Testing**

- Add a focussed unit test for `BreathingSpaceEventStrategy` covering:
  - Standard enter with/without reference/start dates (timeline fallback).
  - Standard lift with expected end missing.
  - Mental-health enter/lift variants.
- Re-run `EventHistoryMapperTest` and the golden snapshot suite to ensure emitted JSON is unchanged.

**Documentation**

- Log each strategy extraction as a new pass in this file (what moved, helpers used, tests run).
- Capture any necessary follow-up (e.g. strategys needing additional shared utilities).

**Next candidates**

- After breathing space, prioritise strategys for default judgment/offline, mediation, and paper proceedings, repeating the same extraction/testing pattern.

**Progress Log**

- 2025-10-29 (Phase 2 – pass 1): Introduced `EventHistoryStrategy` SPI, extracted breathing-space logic into `BreathingSpaceEventStrategy`, wired it into `EventHistoryMapper`, and added focussed strategy tests alongside the golden regression sweep.
- 2025-10-29 (Phase 2 – pass 2): Extracted default-judgment events to `DefaultJudgmentEventStrategy`, recreated the miscellaneous DJ messaging via the new helper, refreshed mapper/data-mapper beans, and kept golden snapshots unchanged.
- 2025-10-29 (Phase 2 – pass 3): Moved mediation handling into `MediationEventStrategy`, centralised claimant DQ helpers via `RoboticsDirectionsQuestionnaireSupport`, added `RoboticsEventTextFormatter.inMediation()`, refreshed Spring test wiring, and ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.MediationEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperTest`.
- 2025-10-29 (Phase 2 – pass 4): Added `DefendantNoCDeadlineStrategy` to emit the NoC deadline offline event, removed the mapper-side helper, and extended the strategy/unit/golden regression runs via `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.DefendantNoCDeadlineStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.MediationEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperTest`.
- 2025-10-29 (Phase 2 – pass 5): Extracted the `CaseProceedsInCasemanStrategy`, deleted the legacy `buildClaimTakenOfflineAfterSDO` branch, hardened strategy tests for SDO/non-SDO paths, and re-ran the focussed regression cut (`JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseProceedsInCasemanStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.DefendantNoCDeadlineStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.MediationEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.BreathingSpaceEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.DefaultJudgmentEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperForSpecTest`).
- 2025-10-29 (Phase 2 – pass 6): Lifted the manual “taken offline by staff” path into `TakenOfflineByStaffEventStrategy`, introduced `RoboticsManualOfflineSupport` for the shared wording, and gated strategy execution with the state-flow history so non-offline scenarios stay untouched. Regression command: `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineByStaffEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseProceedsInCasemanStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.DefendantNoCDeadlineStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.MediationEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.BreathingSpaceEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.DefaultJudgmentEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperForSpecTest`.
- 2025-10-29 (Phase 2 – pass 11): Added strategys for claim issued/notified/details-notified and the post-claim-notification offline branch (`ClaimIssuedEventStrategy`, `ClaimNotifiedEventStrategy`, `ClaimDetailsNotifiedEventStrategy`, `TakenOfflineAfterClaimNotifiedStrategy`), dropped the mapper helpers, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimIssuedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimNotifiedEventStrategyTest`.
- 2025-10-29 (Phase 2 – pass 12): Extracted the claim-details/applicant-response offline events, claim-dismissed variants, litigation-friend, and case query emissions into strategys (`TakenOfflineAfterClaimDetailsNotifiedStrategy`, `TakenOfflinePastApplicantResponseStrategy`, `ClaimDismissedPastNotificationsStrategy`, `ClaimDismissedPastDeadlineStrategy`, `RespondentLitigationFriendStrategy`, `CaseQueriesStrategy`), removed the mapper implementations, and ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimIssuedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimNotifiedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDetailsNotifiedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineAfterClaimNotifiedStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineAfterClaimDetailsNotifiedStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflinePastApplicantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDismissedPastNotificationsStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDismissedPastDeadlineStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentLitigationFriendStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseQueriesStrategyTest`.
- 2025-10-29 (Phase 2 – pass 13): Shifted the unrepresented/unregistered defendant branches into `UnrepresentedDefendantStrategy`, `UnregisteredDefendantStrategy`, and `UnrepresentedAndUnregisteredDefendantStrategy`, deleted the mapper helpers, and validated with `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimIssuedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimNotifiedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDetailsNotifiedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineAfterClaimNotifiedStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineAfterClaimDetailsNotifiedStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflinePastApplicantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDismissedPastNotificationsStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDismissedPastDeadlineStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentLitigationFriendStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseQueriesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.UnrepresentedDefendantStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.UnregisteredDefendantStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.UnrepresentedAndUnregisteredDefendantStrategyTest`.
- 2025-10-29 (Phase 2 – pass 14): Moved the acknowledgement-of-service logic into `AcknowledgementOfServiceStrategy`, removed the mapper branch, and reran the focussed regression suite `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.AcknowledgementOfServiceStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimIssuedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimNotifiedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDetailsNotifiedEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineAfterClaimNotifiedStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineAfterClaimDetailsNotifiedStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflinePastApplicantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDismissedPastNotificationsStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimDismissedPastDeadlineStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentLitigationFriendStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseQueriesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.UnrepresentedDefendantStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.UnregisteredDefendantStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.UnrepresentedAndUnregisteredDefendantStrategyTest`.
- 2025-10-29 (Phase 2 – pass 15): Deleted the unused `buildDefaultJudgment` and `buildMiscellaneousDJEvent` mapper remnants now covered by strategys, keeping the mapper surface aligned with the strategy layer.
- 2025-10-29 (Phase 2 – pass 16): Extracted consent-extension events into `ConsentExtensionEventStrategy`, removed the mapper helper/Spec wiring, added focussed strategy tests, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest`.
- 2025-10-29 (Phase 2 – pass 17): Moved strike-out GA handling into `GeneralApplicationStrikeOutStrategy`, removed the mapper branch/helpers, added focussed strategy tests, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest`.
- 2025-10-29 (Phase 2 – pass 18): Shifted claimant-response logic into `ClaimantResponseStrategy`, removed mapper helpers (proceed/not-proceed, multi-party messaging, applicant DQs), added focussed strategy tests, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest`.
- 2025-10-29 (Phase 2 – pass 19): Extracted case-note emissions into `CaseNotesStrategy`, deleted the mapper case-note helpers, added focussed strategy tests, wired the bean into `EventHistoryMapperTest`, and ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest`.
- 2025-10-29 (Phase 2 – pass 20): Introduced `TakenOfflineSpecDefendantNocStrategy` for the spec defendant notice-of-change offline path, removed the mapper helper, added focussed strategy tests, extended the Spring slice wiring, and ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest`.
- 2025-10-29 (Phase 2 – pass 21): Extracted the SDO-not-drawn branch into `SdoNotDrawnStrategy`, removed the mapper method, added focussed strategy tests, wired the bean into the mapper slice, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest`.
- 2025-10-29 (Phase 2 – pass 22): Moved the spec repayment-plan rejection event into `SpecRejectRepaymentPlanStrategy`, deleted the mapper helper + sequence guard, added dedicated unit coverage, wired the bean into the Spring slice, and validated with `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.JudgmentByAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SpecRejectRepaymentPlanStrategyTest`.
- 2025-10-29 (Phase 2 – pass 23): Extracted the counter-claim miscellaneous branch into `RespondentCounterClaimStrategy`, centralised respondent narrative text via `RoboticsRespondentResponseSupport`, removed the mapper helper/case statement, refreshed the Spring slices, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.JudgmentByAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SpecRejectRepaymentPlanStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentCounterClaimStrategyTest`.
- 2025-10-29 (Phase 2 – pass 22): Moved the summary-judgment miscellaneous event into `SummaryJudgmentStrategy`, dropped the mapper helper/call, added focussed strategy coverage, wired the bean into the Spring slice, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest`.
- 2025-10-29 (Phase 2 – pass 23): Shifted the interlocutory-judgment branch into `InterlocutoryJudgmentStrategy`, removed the mapper helper/call, added focussed strategy tests, updated the Spring slice, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest`.
- 2025-10-29 (Phase 2 – pass 24): Broke out the JO set-aside branch into `SetAsideJudgmentStrategy`, deleted the legacy mapper helper, ported the detail builder, added focussed strategy tests, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest`.
- 2025-10-29 (Phase 2 – pass 25): Extracted the COSC event into `CertificateOfSatisfactionOrCancellationStrategy`, mirrored the original sequencing/date guards, added focussed unit tests, refreshed the mapper slice, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CertificateOfSatisfactionOrCancellationStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest`.
- 2025-10-29 (Phase 2 – pass 26): Moved the CCJ judgment-by-admission flow into `JudgmentByAdmissionStrategy`, removed the mapper helper + supporting methods, added focussed strategy tests, refreshed Spring wiring, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.JudgmentByAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CertificateOfSatisfactionOrCancellationStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest`.
- 2025-10-29 (Phase 2 – pass 27): Shifted the respondent full-admission branch into `RespondentFullAdmissionStrategy`, reusing `RoboticsRespondentResponseSupport`, `RoboticsSequenceGenerator`, and `RoboticsTimelineHelper` for sequencing and messaging, removed the mapper delegation, refreshed the Spring slice wiring/tests, and ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.JudgmentByAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SpecRejectRepaymentPlanStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentCounterClaimStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentFullAdmissionStrategyTest`.
- 2025-10-29 (Phase 2 – pass 28): Moved the respondent part-admission flow into `RespondentPartAdmissionStrategy`, centralising respondent messaging via `RoboticsRespondentResponseSupport`, reusing the shared sequencing/timeline helpers, pruning the mapper branch/helpers, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.JudgmentByAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SpecRejectRepaymentPlanStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentCounterClaimStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentFullAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentPartAdmissionStrategyTest`.
- 2025-10-29 (Phase 2 – pass 29): Extracted the respondent full-defence flow into `RespondentFullDefenceStrategy`, extended `RoboticsRespondentResponseSupport` to supply the shared DQ text, deleted the mapper branch/helpers, refreshed the Spring wiring plus focussed unit coverage, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.JudgmentByAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SpecRejectRepaymentPlanStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentCounterClaimStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentFullAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentPartAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentFullDefenceStrategyTest`.
- 2025-10-29 (Phase 2 – pass 30): Lifted the divergent 1v2 respondent branch into `RespondentDivergentResponseStrategy`, deleted the remaining mapper helpers/sequencers tied to that flow, wired the new strategy plus focussed unit coverage, and re-ran `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ConsentExtensionEventStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.GeneralApplicationStrikeOutStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.ClaimantResponseStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.CaseNotesStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.TakenOfflineSpecDefendantNocStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SdoNotDrawnStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.InterlocutoryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SummaryJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.JudgmentByAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SetAsideJudgmentStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.SpecRejectRepaymentPlanStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentCounterClaimStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentFullAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentPartAdmissionStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentFullDefenceStrategyTest --tests uk.gov.hmcts.reform.civil.service.robotics.strategy.RespondentDivergentResponseStrategyTest`.
---

## Future Notes

- Append findings, utilities, and strategy ownership here as phases progress.
- Record any intentional behavioural changes alongside updated golden fixtures.

## Phase 3 – Utility Alignment (Plan)

**Goal**  
Consolidate shared robotics data helpers (solicitor and party builders) and align the spec/unspec data mappers with the Phase 1 utility layer.

**Progress Log**

- 2025-10-29 (Phase 3 – pass 1): Introduced `RoboticsCaseDataSupport` to centralise solicitor/address/litigious-party helpers, refactored `RoboticsDataMapper` and `RoboticsDataMapperForSpec` to delegate to it, deleted the duplicated mapper helpers, and added focussed coverage (`RoboticsCaseDataSupportTest`). Regression run: `JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperForSpecTest --tests uk.gov.hmcts.reform.civil.service.robotics.support.RoboticsCaseDataSupportTest`.
- 2025-10-29 (Phase 3 – pass 2): Extended `RoboticsCaseDataSupport` with a reusable solicitor builder (including centralised reference truncation), refactored the spec/unspec data mappers to consume it, tightened the support unit tests, and reran the focussed regression suite (`JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperForSpecTest --tests uk.gov.hmcts.reform.civil.service.robotics.support.RoboticsCaseDataSupportTest`).
- 2025-10-29 (Phase 3 – pass 3): Added `resolveRespondentSolicitorId` to `RoboticsCaseDataSupport` so respondent-solicitor ID selection is shared across spec/unspec mappers, expanded unit coverage, and validated with the focussed regression cut (`JAVA_HOME=/opt/homebrew/opt/openjdk@17/libexec/openjdk.jdk/Contents/Home ./gradlew :test --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.EventHistoryGoldenSnapshotTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperTest --tests uk.gov.hmcts.reform.civil.service.robotics.mapper.RoboticsDataMapperForSpecTest --tests uk.gov.hmcts.reform.civil.service.robotics.support.RoboticsCaseDataSupportTest`).
